<!DOCTYPE html>
<html>

<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1, user-scalable=yes">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-capable" content="yes">

  <link href="https://fonts.googleapis.com/css?family=Lato:300,300i,400,400i,700,700i" rel="stylesheet">
  <link href="assets/vendor/font-awesome/css/font-awesome.min.css" rel="stylesheet">
  <link href="assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
  <link href="assets/vendor/jquery-ui/css/jquery-ui.min.css" rel="stylesheet">
  <link href="assets/vendor/jquery-ui-sliderbutton/css/jquery.ui.sliderbutton.css" rel="stylesheet">
  <link rel="stylesheet" type="text/css" href="assets/css/style.css">

  <title>Sample Visitor Management System Screen</title>
</head>



<body style="background-color:#F3FFFF;">

    <div id="sample-main" class="container-fluid">
      <div class="row">
        <div class="col-sm-12 welcome-header">
            <h1>VISITOR MANAGEMENT SYSTEM</h1>
        </div>
        <div class="col-sm-12 welcome-category">
            <p>To begin, use the SingPass Mobile (TEST) screen on the right to simulate the scanning of the QR Code displayed on the kiosk.</p>
            <p>Once the consent is given on the SingPass Mobile (TEST) screen, the fields below will be populated by the payload file received using a listener.</p>
        </div>
      </div>
      <hr class="pb-3">
      <div class="row mt-4">
        <label class="col-sm-3">
            Name:
        </label>
        <input class="col-sm-6" type="text" name="name" id="name" disabled>
      </div>
      <div class="row mt-2">
        <label class="col-sm-3">
            Partial NRIC:
        </label>
        <input class="col-sm-6" type="text" name="name" id="partialuinfin" disabled>
      </div>
      <div class="row mt-2">
        <label class="col-sm-3">
            Race:
        </label>
        <input class="col-sm-6" type="text" name="name" id="race" disabled>
      </div>
      <div class="row mt-2">
        <label class="col-sm-3">
            Date of Birth:
        </label>
        <input class="col-sm-6" type="text" name="name" id="dob" disabled>
      </div>
      <div class="row mt-2">
        <label class="col-sm-3">
            Mobile No:
        </label>
        <input class="col-sm-6" type="text" name="name" id="mobileno" disabled>
      </div>

        <a class="restart-link" onclick="reset()" id="resetButton">
            <span class="fa fa-undo"></span> RESTART
        </a>
        </div>
      </div>
    </div>

    <script type="text/javascript" src="assets/vendor/jquery-3.4.1.min.js"></script>
    <script>
      window.onload = function(){
        $("#resetButton").hide();

        // 'state' should be randomly generated and add to QR
        // This is just a demo, it is set in config.json
        var state;
        $.ajax({
            url: "http://localhost:3002/applicationstate",
            type: "GET",
            success: function(data) {
              state = data;
            },
            dataType: "json",
            timeout: 5000
        });

        (function poll() {
          setTimeout(function() {
              $.ajax({
                  url: "http://localhost:3002/getData?state="+state,
                  type: "GET",
                  success: function(data) {
                    $("#resetButton").show();
                    populate(data);
                  },
                  dataType: "json",
                  complete: poll,
                  timeout: 5000
              })
          }, 5000);
        })();
      }

      function reset(){
        $("#resetButton").hide();
        resetForm();
      }

      function populate(data){
        document.getElementById('name').innerHTML = data.name ? data.name.value : "";
        document.getElementById('partialuinfin').innerHTML = data.partialuinfin ? data.partialuinfin.value : "";
        document.getElementById('dob').innerHTML = data.dob ? formatDate(data.dob.value) : "";
        document.getElementById('race').innerHTML = data.race ? data.race.desc : "";
        document.getElementById('mobileno').innerHTML = data.mobileno ? data.mobileno.nbr.value : "";
      }

      function resetForm(){
        document.getElementById('name').innerHTML = "";
        document.getElementById('partialuinfin').innerHTML = "";
        document.getElementById('dob').innerHTML =  "";
        document.getElementById('race').innerHTML =  "";
        document.getElementById('mobileno').innerHTML =  "";
      }

      function formatDate(date) {
        var d = new Date(date);
        var monthNames = [
          "Jan", "Feb", "Mar",
          "Apr", "May", "Jun", "Jul",
          "Aug", "Sep", "Oct",
          "Nov", "Dec"
        ];

        var day = d.getDate();
        var monthIndex = d.getMonth();
        var year = d.getFullYear();

        return day + ' ' + monthNames[monthIndex] + ' ' + year;
      }
    </script>

</body>
